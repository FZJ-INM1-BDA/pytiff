image: Visual Studio 2022

branches:
  only:
    - master
    - /[0-9]+\.[0-9]+\.[0-9]+/ # <-- allow tag builds like 0.8.2

environment:
  TWINE_USERNAME: __token__
  # TWINE_PASSWORD is set securely in the AppVeyor UI

init:
  - cmd: echo AppVeyor build %APPVEYOR_BUILD_NUMBER% on %APPVEYOR_REPO_BRANCH%

install:
  - choco install python --version=3.11.9 -y
  - set PATH=C:\Python311;C:\Python311\Scripts;%PATH%
  - python -m pip install --upgrade pip
  - python -m pip install --upgrade build twine

build_script:
  - python --version
  - python -m build

test_script:
  - python -c "print('no tests configured')"

artifacts:
  - path: dist\*

on_success:
  - ps: if ($env:APPVEYOR_REPO_TAG -eq "true") { cmd /c "python -m twine upload --non-interactive dist/* -u %TWINE_USERNAME% -p %TWINE_PASSWORD%" } else { echo "Not a tag build; skipping PyPI upload." }
